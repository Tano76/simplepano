<!DOCTYPE html>
<html>
<head>
    <title>simplepano</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="Icons/simplepano.ico?v=2" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
    <style>
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; }
        canvas { width: 100%; height: 100%; touch-action: none; }
        #logoButton {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 10;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: 1px solid white;
            padding: 10px 20px;
            border-radius: 10px;
            font-family: 'Russo One', sans-serif;
            font-size: 24px;
            cursor: pointer;
        }
        #loader-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 20;
        }
        .loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @media (max-width: 768px) {
            #logoButton {
                font-size: 16px;
                padding: 8px 12px;
                bottom: 10px;
                right: 10px;
                border-radius: 8px;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/babylonjs@6.0.0/babylon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/babylonjs-loaders@6.0.0/babylonjs.loaders.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/babylonjs-gui@6.0.0/babylon.gui.min.js"></script>
    <script src="https://cdn.babylonjs.com/babylon.ktx2Decoder.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
    <div id="loader-container">
        <div class="loader"></div>
    </div>
    <button id="logoButton">by simplepano</button>
    <canvas id="renderCanvas"></canvas>
    <script>
const _c=document.getElementById("renderCanvas"),_e=new BABYLON.Engine(_c,!0);async function _l(_z){const _p=await JSZip.loadAsync(_z),_s=await _p.file("scene.json").async("string"),_d=JSON.parse(_s),_a=new BABYLON.Scene(_e);_a.clearColor=new BABYLON.Color3(0,0,0);const _cd=_d.camera.TourCamera,_tc=new BABYLON.ArcRotateCamera("camera",_cd.alpha,_cd.beta,_cd.radius,new BABYLON.Vector3(_cd.target.x,_cd.target.y,_cd.target.z),_a);_tc.setPosition(new BABYLON.Vector3(_cd.position.x,_cd.position.y,_cd.position.z));_tc.lowerRadiusLimit=_tc.radius;_tc.upperRadiusLimit=_tc.radius;_tc.attachControl(_c,!0);const _sm=new Map,_dm=1e3;for(const _sd of _d.spheres){const _sp=BABYLON.MeshBuilder.CreateSphere(_sd.name,{diameter:_dm,segments:32,sideOrientation:BABYLON.Mesh.BACKSIDE},_a);_sp.position=new BABYLON.Vector3(_sd.position.x,_sd.position.y,_sd.position.z);_sp.id=_sd.id;_sm.set(_sd.id,_sp);const _m=new BABYLON.StandardMaterial(_sd.name+"_material",_a);if(_sd.texture){const _tp=_sd.texture,_tf=_p.file(_tp);if(_tf){let _t;if(_tp.toLowerCase().endsWith(".ktx2")){const _b=await _tf.async("arraybuffer");_t=new BABYLON.Texture("data:"+_tp,_a,!1,!1,BABYLON.Texture.BILINEAR_SAMPLINGMODE,null,null,_b,!0)}else{const _bl=await _tf.async("blob"),_u=URL.createObjectURL(_bl);_t=new BABYLON.Texture(_u,_a,!1,!1,BABYLON.Texture.BILINEAR_SAMPLINGMODE);_t.onDisposeObservable.add(()=>{URL.revokeObjectURL(_u)})}_m.emissiveTexture=_t;_m.emissiveTexture.level=0;_m.backFaceCulling=!0;_m.emissiveTexture.uOffset=_sd.uvOffset.u||0}}_sp.material=_m}const _r=_cs=>{_sm.forEach(_sp=>{if(_sp.material&&_sp.material.emissiveTexture)_sp.material.emissiveTexture.level=_sp===_cs?1:0})},_n=_cs=>{_r(_cs);const _gm=new BABYLON.GUI.GUI3DManager(_a),_csph=_d.connections.filter(_cn=>_cn.sphere1Id===_cs.id||_cn.sphere2Id===_cs.id).map(_cn=>_cn.sphere1Id===_cs.id?_sm.get(_cn.sphere2Id):_sm.get(_cn.sphere1Id));_csph.forEach((_csp,_i)=>{const _ar=new BABYLON.GUI.Button3D("navarrow"+_i);_gm.addControl(_ar);const _am=new BABYLON.StandardMaterial("arrowMaterial",_a);_am.diffuseTexture=new BABYLON.Texture("Icons/arrow-4.svg",_a);_am.diffuseTexture.hasAlpha=!0;_am.backFaceCulling=!1;_am.specularColor=BABYLON.Color3.Black();_am.emissiveColor=BABYLON.Color3.White();_ar.mesh.material=_am;_ar.linkToTransformNode(_cs);_ar.scaling=new BABYLON.Vector3(.2,.2,.2);const _ao=new BABYLON.Vector3(0,-.5,0);_ar.mesh.position.addInPlace(_ao);const _di=_csp.position.subtract(_cs.position).normalize(),_upv=BABYLON.Axis.Y,_rq=BABYLON.Quaternion.RotationQuaternionFromAxis(_di,_upv,BABYLON.Vector3.Cross(_di,_upv)),_xr=BABYLON.Quaternion.RotationAxis(BABYLON.Axis.X,Math.PI/2);_ar.mesh.rotationQuaternion=_rq.multiply(_xr);_ar.mesh.position=_di.scale(.4).add(_ao);_ar.onPointerEnterObservable.add(()=>{_ar.scaling=new BABYLON.Vector3(.3,.3,.3)});_ar.onPointerOutObservable.add(()=>{_ar.scaling=new BABYLON.Vector3(.2,.2,.2)});_ar.onPointerClickObservable.add(()=>{const _fr=60,_ad=_fr*1.5,_es=new BABYLON.CubicEase;_es.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT);const _foa=new BABYLON.Animation("textureLevelFadeOut","material.emissiveTexture.level",_fr,BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);_foa.setKeys([{frame:0,value:1},{frame:_ad*.6,value:0}]);_foa.setEasingFunction(_es);const _fia=new BABYLON.Animation("textureLevelFadeIn","material.emissiveTexture.level",_fr,BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);_fia.setKeys([{frame:0,value:0},{frame:_ad*.4,value:0},{frame:_ad,value:1}]);_fia.setEasingFunction(_es);_cs.animations=[_foa];_csp.animations=[_fia];const _it=_tc.target.clone(),_tga=new BABYLON.Animation("cameraTarget","target",_fr,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);_tga.setKeys([{frame:0,value:_it},{frame:_ad,value:_csp.position.clone()}]);_tga.setEasingFunction(_es);_tc.animations=[_tga];_a.beginAnimation(_cs,0,_ad,!1);_a.beginAnimation(_csp,0,_ad,!1);_a.beginAnimation(_tc,0,_ad,!1,1,()=>{_gm.dispose();_n(_csp)})})})};_n(Array.from(_sm.values())[0]);_e.runRenderLoop(()=>_a.render());window.addEventListener("resize",()=>_e.resize())}async function _L(){const _lc=document.getElementById("loader-container");try{const _res=await fetch(atob("TEFNQURSSUQuemlw"));if(!_res.ok)throw new Error(`HTTP error! status: ${_res.status}`);const _z=await _res.blob();await _l(_z)}catch(_err){console.error("Failed to load default tour:",_err)}finally{if(_lc){_lc.style.display="none"}}} _L();
    </script>
</body>
</html>
